#!/usr/bin/env python3
import argparse
from pathlib import Path
from sys import stdout, stdin


def to_hex(n):
    return f"{n:02X}"


def process(file, args):
    if args.hex:
        stringify = to_hex
    else:
        stringify = str

    has_written_first = False

    while True:
        chunk = file.read(1024)
        if not chunk:
            break

        for byte in chunk:
            if has_written_first:
                stdout.write(args.delimiter)
            else:
                has_written_first = True
            stdout.write(stringify(byte))


def main():
    parser = argparse.ArgumentParser(
        description="Get a delimiter-separated list of bytes from a file or stdin"
    )
    parser.add_argument(
        "file", nargs="?", type=Path, help="The file to dump. Defaults to stdin"
    )
    parser.add_argument("--delimiter", type=str, default=",", help="Delimiter")
    parser.add_argument("--hex", action="store_true", help="Output as hex")
    args = parser.parse_args()

    if args.file is None:
        process(stdin.buffer, args)
    else:
        with open(args.file, "rb") as file:
            process(file, args)


if __name__ == "__main__":
    main()
